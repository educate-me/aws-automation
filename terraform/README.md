# aws-iac

A fully automated deployment of multiple services of AWS using Hashicorp Terraform.

## Requirements

Make sure you switch to the master branch before continuing further

```bash
> git checkout master
```

### Installation

Make sure the following installations are avialable with their latest versions before starting:

* [Hashicorp Terraform](https://www.terraform.io/downloads.html) `v0.12.4 +`

```bash
> terraform --version

Terraform v0.12.4
```

### Provider Configuration

The `Amazon Web Services (AWS)` provider is used to interact with the many resources supported by `AWS`. The provider needs to be configured with the proper credentials before it can be used.

You can provide your credentials via the `AWS_ACCESS_KEY_ID` and `AWS_SECRET_ACCESS_KEY`, environment variables, representing your `AWS Access Key` and `AWS Secret Key`, respectively.

```bash
> export AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID
> export AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY
```

## Execution

Change directory to terraform environment root.

```bash
> cd terraform/aws-networking/environments/dev-env
```

### Initialize

The `terraform init` command is used to initialize a working directory containing Terraform configuration files. This is the first command that should be run after writing a new Terraform configuration or cloning an existing one from version control. It is safe to run this command multiple times.

```bash
> terraform init

Initializing provider plugins...
- Checking for available provider plugins...
- Downloading plugin for provider "aws" (terraform-providers/aws) 2.19.0...

The following providers do not have any version constraints in configuration,
so the latest version was installed.

To prevent automatic upgrades to new major versions that may contain breaking
changes, it is recommended to add version = "..." constraints to the
corresponding provider blocks in configuration, with the constraint strings
suggested below.

* provider.aws: version = "~> 2.19"

Terraform has been successfully initialized!

You may now begin working with Terraform. Try running "terraform plan" to see
any changes that are required for your infrastructure. All Terraform commands
should now work.

If you ever set or change modules or backend configuration for Terraform,
rerun this command to reinitialize your working directory. If you forget, other
commands will detect it and remind you to do so if necessary.

```

### Dry Run [ Sample ]

The `terraform plan` command is used to create an execution plan. Terraform performs a refresh, unless explicitly disabled, and then determines what actions are necessary to achieve the desired state specified in the configuration files.

```bash
> terraform plan

Refreshing Terraform state in-memory prior to plan...
The refreshed state will be used to calculate this plan, but will not be
persisted to local or remote state storage.


------------------------------------------------------------------------

An execution plan has been generated and is shown below.
Resource actions are indicated with the following symbols:
  + create

Terraform will perform the following actions:

  # module.network.aws_vpc.main will be created
  + resource "aws_vpc" "main" {
      + arn                              = (known after apply)
      + assign_generated_ipv6_cidr_block = false
      + cidr_block                       = "10.0.0.0/16"
      + default_network_acl_id           = (known after apply)
      + default_route_table_id           = (known after apply)
      + default_security_group_id        = (known after apply)
      + dhcp_options_id                  = (known after apply)
      + enable_classiclink               = (known after apply)
      + enable_classiclink_dns_support   = (known after apply)
      + enable_dns_hostnames             = (known after apply)
      + enable_dns_support               = true
      + id                               = (known after apply)
      + instance_tenancy                 = "dedicated"
      + ipv6_association_id              = (known after apply)
      + ipv6_cidr_block                  = (known after apply)
      + main_route_table_id              = (known after apply)
      + owner_id                         = (known after apply)
      + tags                             = {
          + "Name" = "main"
        }
    }

Plan: 1 to add, 0 to change, 0 to destroy.

------------------------------------------------------------------------

Note: You didn't specify an "-out" parameter to save this plan, so Terraform
can't guarantee that exactly these actions will be performed if
"terraform apply" is subsequently run.
```

### Deploy

The `terraform apply` command is used to apply the changes required to reach the desired state of the configuration, or the pre-determined set of actions generated by a `terraform plan` execution plan.

```bash
> terraform apply

An execution plan has been generated and is shown below.
Resource actions are indicated with the following symbols:
  + create

Terraform will perform the following actions:

  # module.network.aws_vpc.main will be created
  + resource "aws_vpc" "main" {
      + arn                              = (known after apply)
      + assign_generated_ipv6_cidr_block = false
      + cidr_block                       = "10.0.0.0/16"
      + default_network_acl_id           = (known after apply)
      + default_route_table_id           = (known after apply)
      + default_security_group_id        = (known after apply)
      + dhcp_options_id                  = (known after apply)
      + enable_classiclink               = (known after apply)
      + enable_classiclink_dns_support   = (known after apply)
      + enable_dns_hostnames             = (known after apply)
      + enable_dns_support               = true
      + id                               = (known after apply)
      + instance_tenancy                 = "dedicated"
      + ipv6_association_id              = (known after apply)
      + ipv6_cidr_block                  = (known after apply)
      + main_route_table_id              = (known after apply)
      + owner_id                         = (known after apply)
      + tags                             = {
          + "Name" = "main"
        }
    }

Plan: 1 to add, 0 to change, 0 to destroy.

Do you want to perform these actions?
  Terraform will perform the actions described above.
  Only 'yes' will be accepted to approve.

  Enter a value: yes

module.network.aws_vpc.main: Creating...
module.network.aws_vpc.main: Still creating... [10s elapsed]
module.network.aws_vpc.main: Creation complete after 14s [id=vpc-0a82ee9301953fbee]

Apply complete! Resources: 1 added, 0 changed, 0 destroyed.
```

### Destroy

The `terraform destroy` command is used to destroy the Terraform-managed infrastructure.

```bash
terraform destroy

module.network.aws_vpc.main: Refreshing state... [id=vpc-0a82ee9301953fbee]

An execution plan has been generated and is shown below.
Resource actions are indicated with the following symbols:
  - destroy

Terraform will perform the following actions:

  # module.network.aws_vpc.main will be destroyed
  - resource "aws_vpc" "main" {
      - arn                              = "arn:aws:ec2:us-east-1:475672942422:vpc/vpc-0a82ee9301953fbee" -> null
      - assign_generated_ipv6_cidr_block = false -> null
      - cidr_block                       = "10.0.0.0/16" -> null
      - default_network_acl_id           = "acl-093cea50fbdb95e87" -> null
      - default_route_table_id           = "rtb-0aedfd54dc832b187" -> null
      - default_security_group_id        = "sg-0416e7062ca607cb5" -> null
      - dhcp_options_id                  = "dopt-3c98b247" -> null
      - enable_classiclink               = false -> null
      - enable_classiclink_dns_support   = false -> null
      - enable_dns_hostnames             = false -> null
      - enable_dns_support               = true -> null
      - id                               = "vpc-0a82ee9301953fbee" -> null
      - instance_tenancy                 = "dedicated" -> null
      - main_route_table_id              = "rtb-0aedfd54dc832b187" -> null
      - owner_id                         = "475672942422" -> null
      - tags                             = {
          - "Name" = "main"
        } -> null
    }

Plan: 0 to add, 0 to change, 1 to destroy.

Do you really want to destroy all resources?
  Terraform will destroy all your managed infrastructure, as shown above.
  There is no undo. Only 'yes' will be accepted to confirm.

  Enter a value: yes

module.network.aws_vpc.main: Destroying... [id=vpc-0a82ee9301953fbee]
module.network.aws_vpc.main: Destruction complete after 1s

Destroy complete! Resources: 1 destroyed.
```
